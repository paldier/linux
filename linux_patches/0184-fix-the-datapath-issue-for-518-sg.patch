From f4ee7aba29f6784514e3f3e189632d3dc09778c9 Mon Sep 17 00:00:00 2001
From: Wu Zhixian <zhixianx.wu@intel.com>
Date: Thu, 2 Aug 2018 19:04:39 +0800
Subject: [PATCH] fix the datapath issue for 518 sg

---
 drivers/net/ethernet/lantiq/datapath/datapath_api.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/lantiq/datapath/datapath_api.c b/drivers/net/ethernet/lantiq/datapath/datapath_api.c
index 93d7c7c09c4c..6a2bdf9ed3e1 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath_api.c
+++ b/drivers/net/ethernet/lantiq/datapath/datapath_api.c
@@ -521,7 +521,7 @@ int32_t dp_register_subif_private(int inst, struct module *owner,
 	}
 
 	/*PR_INFO("search range: start=%d end=%d\n",start, end);*/
-	/*allocate a free subif */
+    /*allocate a free subif */
 	for (i = start; i < end; i++) {
 		if (port_info->subif_info[i].flags) /*used already & not free*/
 			continue;
@@ -2294,6 +2294,10 @@ int32_t dp_xmit(struct net_device *rx_if, dp_subif_t *rx_subif,
 							dp_info2);
 			DP_CB(inst, set_pmac_subif)(&pmac, rx_subif->subif);
 			insert_pmac_f = 1;
+#ifdef CONFIG_LTQ_DATAPATH_ACA_CSUM_WORKAROUND
+			if (aca_portid > 0)
+				desc_1->field.ep = aca_portid;
+#endif
 		} else { /*no pmac */
 			DP_CB(inst, get_dma_pmac_templ)(TEMPL_NORMAL, NULL,
 							desc_0, desc_1,
