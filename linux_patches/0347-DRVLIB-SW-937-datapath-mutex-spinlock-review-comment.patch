From cfb8482ebcd25bbabd7f093e7b6dd2239b1250fa Mon Sep 17 00:00:00 2001
From: Rekha Eswaran <rekha.eswaran@intel.com>
Date: Fri, 19 Oct 2018 13:10:41 +0800
Subject: [PATCH] DRVLIB_SW-937: datapath mutex/spinlock review comments and
 remove unwanted QoS error message

---
 drivers/net/ethernet/lantiq/datapath/datapath.h              | 4 +++-
 drivers/net/ethernet/lantiq/datapath/datapath_misc.c         | 7 +++----
 drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c | 2 --
 3 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/datapath/datapath.h b/drivers/net/ethernet/lantiq/datapath/datapath.h
index 61c02a620db6..6e4578291a6d 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath.h
+++ b/drivers/net/ethernet/lantiq/datapath/datapath.h
@@ -118,7 +118,9 @@
 #define IFNAMSIZ 16
 #define DP_MAX_HW_CAP 4
 
-/*#define DP_SPIN_LOCK */
+#if (!IS_ENABLED(CONFIG_FALCONMX_CQM))
+#define DP_SPIN_LOCK 
+#endif
 #ifdef DP_SPIN_LOCK
 #define DP_LIB_LOCK    spin_lock_bh
 #define DP_LIB_UNLOCK  spin_unlock_bh
diff --git a/drivers/net/ethernet/lantiq/datapath/datapath_misc.c b/drivers/net/ethernet/lantiq/datapath/datapath_misc.c
index 3e1925fb3bb5..8d585d6155bd 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath_misc.c
+++ b/drivers/net/ethernet/lantiq/datapath/datapath_misc.c
@@ -1290,14 +1290,14 @@ int32_t	dp_update_subif(struct net_device *netif, void *data,
 	struct dp_subif_cache *dp_subif_new, *dp_subif;
 	u32 idx;
 	int inst, portid, vap;
-	dp_get_netif_subifid_fn_t subifid_fn_t;
+	dp_get_netif_subifid_fn_t subifid_fn_t = NULL;
 	struct pmac_port_info *port_info;
 
 	idx = dp_subif_hash(netif);
 	inst = subif->inst;
 	portid = subif->port_id;
 	port_info = &dp_port_info[inst][portid];
-	if (subifid_fn_t && !(flags & DP_F_SUBIF_LOGICAL)) {
+	if (!(flags & DP_F_SUBIF_LOGICAL)) {
 		subifid_fn_t = port_info->cb.get_subifid_fn;
 	}
 	vap = GET_VAP(subif->subif, port_info->vap_offset,
@@ -1308,8 +1308,7 @@ int32_t	dp_update_subif(struct net_device *netif, void *data,
 		dp_subif = kzalloc(sizeof(*dp_subif), GFP_KERNEL);
 		if (dp_subif) {
 			memcpy(&dp_subif->subif, subif, sizeof(subif));
-			memcpy((struct dp_subif_data *)dp_subif->data, data,
-			       sizeof(data));
+			memcpy(dp_subif->data, (u8 *)data, IFNAMSIZ);
 			dp_subif->dev = netif;
 			strncpy(dp_subif->name, subif_name,
 				sizeof(dp_subif->name) - 1);
diff --git a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c
index 5a77e819fa92..f6936253b7ba 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c
@@ -1345,8 +1345,6 @@ static int dp_ctp_tc_map_set_31(struct dp_tc_cfg *tc, int flag,
 	gsw_handle = dp_port_prop[mtr_subif->inst].ops[GSWIP_L];
 	ctp_tc_cfg.nLogicalPortId = mtr_subif->subif.port_id;
 	ctp_tc_cfg.nSubIfIdGroup = mtr_subif->subif.subif;
-		PR_ERR("Failed to get CTP info for ep=%d subif=%d\n",
-		       mtr_subif->subif.port_id, mtr_subif->subif.subif);
 	if (gsw_core_api((dp_gsw_cb)gsw_handle->gsw_ctp_ops.CTP_PortConfigGet,
 			 gsw_handle, &ctp_tc_cfg) != 0) {
 		PR_ERR("Failed to get CTP info for ep=%d subif=%d\n",
