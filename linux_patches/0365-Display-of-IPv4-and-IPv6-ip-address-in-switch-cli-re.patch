From b1be6b06ade2de81a7486bec55810fc939564dce Mon Sep 17 00:00:00 2001
From: thampan <joby.thampan@intel.com>
Date: Fri, 23 Nov 2018 15:46:39 +0800
Subject: [PATCH] Display of IPv4 and IPv6 ip address in switch cli read is
 made proper

---
 .../net/ethernet/lantiq/switch-api/gsw_swmcast.c   | 26 ++++++++++++++++++++++
 1 file changed, 26 insertions(+)

diff --git a/drivers/net/ethernet/lantiq/switch-api/gsw_swmcast.c b/drivers/net/ethernet/lantiq/switch-api/gsw_swmcast.c
index 9b4e9a106663..10dc3b43e1bb 100644
--- a/drivers/net/ethernet/lantiq/switch-api/gsw_swmcast.c
+++ b/drivers/net/ethernet/lantiq/switch-api/gsw_swmcast.c
@@ -213,6 +213,7 @@ int gsw_get_swmcast_entry(void *cdev, GSW_multicastTableRead_t *parm, u32 loc)
 	ethsw_api_dev_t *gswdev = GSW_PDATA_GET(cdev);
 	pctbl_prog_t pcetable;
 	int i = 0;
+	GSW_IP_t IP;
 
 	if (gswdev == NULL)
 		return 0;
@@ -241,6 +242,31 @@ int gsw_get_swmcast_entry(void *cdev, GSW_multicastTableRead_t *parm, u32 loc)
 			parm->nPortMap[i] = pcetable.val[2 + i];
 		}
 
+		parm->eIPVersion = phtable[loc].ip_type;
+
+#if CONFIG_CPU_BIG_ENDIAN
+
+		if (parm->eIPVersion == GSW_IP_SELECT_IPV4) {
+			parm->uIP_Gda.nIPv4 = ((parm->uIP_Gda.nIPv6[1] << 16) |
+					       parm->uIP_Gda.nIPv6[0]);
+			parm->uIP_Gsa.nIPv4 = ((parm->uIP_Gsa.nIPv6[1] << 16) |
+					       parm->uIP_Gsa.nIPv6[0]);
+		} else if (parm->eIPVersion == GSW_IP_SELECT_IPV6) {
+			for (i = 0; i < 8; i++)
+				IP.nIPv6[i] = parm->uIP_Gda.nIPv6[7 - i];
+			
+			for (i = 0; i < 8; i++)
+				parm->uIP_Gda.nIPv6[i] = IP.nIPv6[i];
+
+			for (i = 0; i < 8; i++)
+				IP.nIPv6[i] = parm->uIP_Gsa.nIPv6[7 - i];
+			
+			for (i = 0; i < 8; i++)
+				parm->uIP_Gsa.nIPv6[i] = IP.nIPv6[i];			
+		}
+
+#endif
+		
 		parm->nPortId |= 0x8000;
 #ifdef __KERNEL__		
 		pr_debug("Got Loc        %d\n", loc);
