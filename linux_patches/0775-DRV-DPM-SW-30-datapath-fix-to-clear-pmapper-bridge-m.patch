From 5f9f8788b1ee47df8fce7532f98cdc84df43c917 Mon Sep 17 00:00:00 2001
From: Rekha Eswaran <rekha.eswaran@intel.com>
Date: Mon, 9 Sep 2019 14:22:00 +0800
Subject: [PATCH] DRV_DPM_SW-30 datapath fix to clear pmapper
 bridge-member-port & bridge mapping issue(PONRTSYS-4981)

---
 drivers/net/datapath/dpm/datapath_instance.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/net/datapath/dpm/datapath_instance.c b/drivers/net/datapath/dpm/datapath_instance.c
index d687c5c70a32..037c9c010f8e 100644
--- a/drivers/net/datapath/dpm/datapath_instance.c
+++ b/drivers/net/datapath/dpm/datapath_instance.c
@@ -356,7 +356,10 @@ int dp_inst_del_dev(struct net_device *dev, char *subif_name, int inst, int ep,
 		return -1;
 	}
 	list_for_each_entry(tmp, &dp_dev->ctp_list, list) {
-		if (tmp->subif == ctp) {
+		/* Check added to remove pmapper device from dp_dev list
+		 * if pmapper device is unregistered with last gem
+		 */
+		if (dp_dev->dev == dev) {
 			list_del(&tmp->list);
 			dp_dev->count--;
 
