From a9c2c8b064ed27e0c2ebefb3d72ed4ecb1318fb0 Mon Sep 17 00:00:00 2001
From: kavitha3 <k.subramanian@intel.com>
Date: Thu, 11 Jul 2019 11:56:42 +0800
Subject: [PATCH] DRVLIB_SW-2545: fix klocwork errors in ethernet driver

---
 drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c | 23 ++++++++++++++---------
 1 file changed, 14 insertions(+), 9 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c b/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
index 2dcaa91dddb0..7353fe6dc844 100644
--- a/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
+++ b/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
@@ -255,8 +255,10 @@ static int  ethtool_eee_get(struct net_device *dev,
 {
 	struct core_ops *ops = gsw_get_swcore_ops(0);
 	GSW_portLinkCfg_t	port_link_cfg = {0};
-	int retval = EOPNOTSUPP;
+	int retval = -EOPNOTSUPP;
 
+	if (!ops)
+		return -ENODEV;
 	port_link_cfg.nPortId = dev->dev_id;
 	retval = ops->gsw_common_ops.PortLinkCfgGet(ops, &port_link_cfg);
 
@@ -280,8 +282,10 @@ static int  ethtool_eee_set(struct net_device *dev,
 {
 	struct core_ops *ops = gsw_get_swcore_ops(0);
 	GSW_portLinkCfg_t	port_link_cfg = {0};
-	int retval = EOPNOTSUPP;
+	int retval = -EOPNOTSUPP;
 
+	if (!ops)
+		return -ENODEV;
 	port_link_cfg.nPortId = dev->dev_id;
 	retval = ops->gsw_common_ops.PortLinkCfgGet(ops, &port_link_cfg);
 
@@ -1237,6 +1241,7 @@ ltq_eth_nl_msg_send(int pid, int link_status, int speed, char *if_name)
 
 	if (!msg_head) {
 		ret = -ENOMEM;
+		kfree_skb(skb);
 		pr_err("create message header fail!\n");
 		goto out;
 	}
@@ -1303,7 +1308,6 @@ static int phy_netdevice_event(struct notifier_block *nb, unsigned long action,
 
 	dev = netdev_notifier_info_to_dev(ptr);
 
-
 	switch (action) {
 	case NETDEV_CHANGENAME: {
 		priv = netdev_priv(dev);
@@ -1583,7 +1587,6 @@ static int ltq_eth_dev_reg(struct xrx500_hw *hw, u32 xgmac_id_param,
 	int i, err, num = 1;
 
 	for (i = start; i < end; i++) {
-		char name[16];
 		struct ltq_eth_priv *priv;
 
 		eth_dev[i] = alloc_etherdev_mq(sizeof(struct ltq_eth_priv),
@@ -1601,12 +1604,13 @@ static int ltq_eth_dev_reg(struct xrx500_hw *hw, u32 xgmac_id_param,
 		sprintf(priv->owner->name, "module%02d", priv->id);
 		if (start == i && lct_en == 1) {
 			priv->lct_en = 1;
-			sprintf(name, "eth0_%d_%d_lct", hw->num_devs, num);
+			snprintf(eth_dev[i]->name, IFNAMSIZ,
+				 "eth0_%d_%d_lct", hw->num_devs, num);
 		} else {
-				priv->lct_en = 0;
-				sprintf(name, "eth0_%d_%d",  hw->num_devs, num);
+			priv->lct_en = 0;
+			snprintf(eth_dev[i]->name, IFNAMSIZ,
+				 "eth0_%d_%d",  hw->num_devs, num);
 		}
-		strcpy(eth_dev[i]->name, name);
 
 		eth_dev[i]->netdev_ops = &ltq_eth_drv_ops;
 		ltq_eth_drv_eth_addr_setup(eth_dev[i], priv->id);
@@ -1623,7 +1627,8 @@ static int ltq_eth_dev_reg(struct xrx500_hw *hw, u32 xgmac_id_param,
 
 static int ltq_eth_dev_dereg_subif(int start, int end)
 {
-	int res, i;
+	int i;
+	int res = DP_SUCCESS;
 	struct ltq_eth_priv *priv;
 	struct dp_subif_data data = {0};
 
