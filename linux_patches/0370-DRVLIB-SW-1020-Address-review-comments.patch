From fe993a5294b90904142f450fc6d266aa0e14cd7e Mon Sep 17 00:00:00 2001
From: Rekha Eswaran <rekha.eswaran@intel.com>
Date: Tue, 27 Nov 2018 18:13:30 +0800
Subject: [PATCH] DRVLIB_SW-1020: Address review comments

---
 drivers/net/ethernet/lantiq/datapath/datapath_proc.c         |  2 +-
 drivers/net/ethernet/lantiq/datapath/datapath_proc_qos.c     |  4 ++--
 drivers/net/ethernet/lantiq/datapath/gswip30/datapath_coc.c  |  2 +-
 drivers/net/ethernet/lantiq/datapath/gswip30/datapath_proc.c | 12 ++++++------
 drivers/net/ethernet/lantiq/datapath/gswip31/datapath_coc.c  |  2 +-
 .../ethernet/lantiq/datapath/gswip31/datapath_lookup_proc.c  |  4 ++--
 drivers/net/ethernet/lantiq/datapath/gswip31/datapath_proc.c |  2 +-
 7 files changed, 14 insertions(+), 14 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/datapath/datapath_proc.c b/drivers/net/ethernet/lantiq/datapath/datapath_proc.c
index 644460c6979b..20bc8ae5815a 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath_proc.c
+++ b/drivers/net/ethernet/lantiq/datapath/datapath_proc.c
@@ -439,7 +439,7 @@ ssize_t proc_dbg_write(struct file *file, const char *buf, size_t count,
 	#define BUF_SIZE_TMP 2000
 
 	if (!capable(CAP_SYS_ADMIN))
-		return count;
+		return -EPERM;
 
 	len = (sizeof(str) > count) ? count : sizeof(str) - 1;
 	len -= copy_from_user(str, buf, len);
diff --git a/drivers/net/ethernet/lantiq/datapath/datapath_proc_qos.c b/drivers/net/ethernet/lantiq/datapath/datapath_proc_qos.c
index 6bfd3aa90f10..d6cc961bb138 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath_proc_qos.c
+++ b/drivers/net/ethernet/lantiq/datapath/datapath_proc_qos.c
@@ -858,7 +858,7 @@ int qos_dump(struct seq_file *s, int pos)
 	int i;
 
 	if (!capable(CAP_NET_ADMIN))
-		return -1;
+		return -EPERM;
 	if (pos == 0) {
 		seq_puts(s, "Note:\n");
 		seq_puts(s, "  x/y :physical node/logical node\n");
@@ -962,7 +962,7 @@ ssize_t proc_qos_write(struct file *file, const char *buf, size_t count,
 	unsigned int level = 0, num = 0;
 
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	len = (sizeof(str) > count) ? count : sizeof(str) - 1;
 	len -= copy_from_user(str, buf, len);
 	str[len] = 0;
diff --git a/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_coc.c b/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_coc.c
index 60a5499f5e70..73e3f528bddc 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_coc.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_coc.c
@@ -476,7 +476,7 @@ ssize_t proc_coc_write(struct file *file, const char *buf, size_t count,
 #define MIN_POLL_TIME 1
 
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	len = (sizeof(str) > count) ? count : sizeof(str) - 1;
 	len -= copy_from_user(str, buf, len);
 	str[len] = 0;
diff --git a/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_proc.c b/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_proc.c
index 8bb4f9e7774d..61ead6c2daa6 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_proc.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip30/datapath_proc.c
@@ -159,7 +159,7 @@ static ssize_t proc_parser_write(struct file *file, const char *buf,
 	struct core_ops *gsw_handle;
 
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	memset(&pce, 0, sizeof(pce));
 	gsw_handle = dp_port_prop[inst].ops[GSWIP_R];
 	len = (sizeof(str) > count) ? count : sizeof(str) - 1;
@@ -682,7 +682,7 @@ static int proc_gsw_port_rmon_dump(struct seq_file *s, int pos)
 	char flag_buf[20];
 
 	if (!capable(CAP_NET_ADMIN))
-		return -1;
+		return -EPERM;
 	if (pos == 0) {
 		memset(gsw_r_rmon_mib, 0, sizeof(gsw_r_rmon_mib));
 		memset(gsw_l_rmon_mib, 0, sizeof(gsw_l_rmon_mib));
@@ -960,7 +960,7 @@ static ssize_t proc_gsw_rmon_write(struct file *file, const char *buf,
 	char *param_list[10];
 
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	len = (sizeof(str) > count) ? count : sizeof(str) - 1;
 	len -= copy_from_user(str, buf, len);
 	str[len] = 0;
@@ -1022,7 +1022,7 @@ static int proc_dport_dump(struct seq_file *s, int pos)
 	u32 flag = 0;
 
 	if (!capable(CAP_NET_ADMIN))
-		return -1;
+		return -EPERM;
 	memset(&res, 0, sizeof(cbm_dq_port_res_t));
 	if (cbm_dequeue_port_resources_get(pos, &res, flag) == 0) {
 		seq_printf(s, "Dequeue port=%d free_base=0x%x\n", pos,
@@ -1058,7 +1058,7 @@ int proc_ep_dump(struct seq_file *s, int pos)
 	struct pmac_port_info *port = get_port_info(0, pos);
 #endif
 	if (!capable(CAP_NET_ADMIN))
-		return -1;
+		return -EPERM;
 #if defined(NEW_CBM_API) && NEW_CBM_API
 	if (cbm_dp_port_resources_get
 	    (&pos, &num, &res, port ? port->alloc_flags : flag) == 0) {
@@ -1132,7 +1132,7 @@ ssize_t ep_port_write(struct file *file, const char *buf, size_t count,
 	int inst = 0;
 
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	memset(&pmac_cfg, 0, sizeof(dp_pmac_cfg_t));
 	len = (sizeof(str) > count) ? count : sizeof(str) - 1;
 	len -= copy_from_user(str, buf, len);
diff --git a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_coc.c b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_coc.c
index 59f9ed8c3268..f37f65413987 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_coc.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_coc.c
@@ -187,7 +187,7 @@ ssize_t proc_coc_write(struct file *file, const char *buf, size_t count,
 		       loff_t *ppos)
 {
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	return count;
 }
 
diff --git a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_lookup_proc.c b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_lookup_proc.c
index 9d318bb2fa5a..924896f2e685 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_lookup_proc.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_lookup_proc.c
@@ -396,7 +396,7 @@ int lookup_start31(void)
 int lookup_dump31(struct seq_file *s, int pos)
 {
 	if (!capable(CAP_NET_ADMIN))
-		return -1;
+		return -EPERM;
 	if (find_pattern(pos, s, -1) < 0)
 		return pos;
 	pos++;
@@ -416,7 +416,7 @@ ssize_t proc_get_qid_via_index31(struct file *file, const char *buf,
 	int num;
 
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	len = (count >= sizeof(data)) ? (sizeof(data) - 1) : count;
 	DP_DEBUG(DP_DBG_FLAG_LOOKUP, "len=%d\n", len);
 
diff --git a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_proc.c b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_proc.c
index 8fcbe9b20cb0..d1d9a71513d5 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_proc.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_proc.c
@@ -57,7 +57,7 @@ ssize_t proc_parser_write(struct file *file, const char *buf,
 	struct core_ops *gsw_handle;
 
 	if (!capable(CAP_NET_ADMIN))
-		return count;
+		return -EPERM;
 	memset(&pce, 0, sizeof(pce));
 	gsw_handle = dp_port_prop[inst].ops[GSWIP_R];
 	len = (sizeof(str) > count) ? count : sizeof(str) - 1;
