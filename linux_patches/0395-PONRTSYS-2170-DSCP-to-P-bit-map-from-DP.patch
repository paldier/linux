From 4db1952f060af4228fec6edd83cc24807cf0823b Mon Sep 17 00:00:00 2001
From: Rekha Eswaran <rekha.eswaran@intel.com>
Date: Fri, 14 Dec 2018 15:05:43 +0800
Subject: [PATCH] PONRTSYS-2170: DSCP to P-bit map from DP

---
 drivers/net/ethernet/lantiq/datapath/gswip31/datapath_tc_asym_vlan.c | 3 +++
 include/net/datapath_api_vlan.h                                      | 1 +
 2 files changed, 4 insertions(+)

diff --git a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_tc_asym_vlan.c b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_tc_asym_vlan.c
index 155947eadaeb..ac12f51e47fb 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_tc_asym_vlan.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_tc_asym_vlan.c
@@ -586,6 +586,9 @@ static int ext_vlan_action_cfg(struct core_ops *ops,
 
 	DP_DEBUG(DP_DBG_FLAG_PAE, "act->act: 0x%02x\n", (unsigned int)act->act);
 
+	/* Copy DSCP table */
+	memcpy(pcfg->nDscp2PcpMap, act->dscp_pcp_map,
+	       (sizeof(unsigned char) * 64));
 	/* forward without modification */
 	if ((act->act & DP_VLAN_ACT_FWD))
 		return 0;
diff --git a/include/net/datapath_api_vlan.h b/include/net/datapath_api_vlan.h
index f88511cc89cd..6b5937203fa0 100644
--- a/include/net/datapath_api_vlan.h
+++ b/include/net/datapath_api_vlan.h
@@ -91,6 +91,7 @@ struct dp_act_vlan {
 				*  copy from recv pkt's inner tag(CP_FROM_INNER)
 				*  copy from recv pkt's outer tag(CP_FROM_OUTER)
 				*/
+	unsigned char dscp_pcp_map[64]; /* DSCP to P-bit mapping table */
 };
 
 #define DP_VLAN_DEF_RULE 1
