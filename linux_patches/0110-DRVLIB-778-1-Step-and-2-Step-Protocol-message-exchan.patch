From ea19d93cd3585c809e14fe67748f6b260823da6c Mon Sep 17 00:00:00 2001
From: thampan <joby.thampan@intel.com>
Date: Mon, 2 Jul 2018 16:06:01 +0800
Subject: [PATCH] DRVLIB_778: 1_Step and 2_Step Protocol message exchange
 tested

---
 drivers/net/ethernet/lantiq/switch-api/mac/xgmac_ptp.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/switch-api/mac/xgmac_ptp.c b/drivers/net/ethernet/lantiq/switch-api/mac/xgmac_ptp.c
index 1c020f234263..5b902959365b 100644
--- a/drivers/net/ethernet/lantiq/switch-api/mac/xgmac_ptp.c
+++ b/drivers/net/ethernet/lantiq/switch-api/mac/xgmac_ptp.c
@@ -366,8 +366,10 @@ int xgmac_tx_hwts(void *pdev, struct sk_buff *skb)
 			mac_dbg("1-Step\n");
 			ptp_loc = parse_ptp_packet(skb, &ethtype, &msg_type);
 
-			if (!ptp_loc)
+			if (!ptp_loc) {
+				mac_printf("Parsing PTP packet Error\n");
 				return -1;
+			}
 
 			/* PTP Sync if we are Master TTSE=0 OSTC=1, OSTPA=0 */
 			rec_id = fifo_entry_add(pdev, 0, 1, 0, 0, 0, 0);
@@ -380,9 +382,6 @@ int xgmac_tx_hwts(void *pdev, struct sk_buff *skb)
 			/* if -1, CPU should drop the packet */
 			return -1;
 		}
-
-		if (IS_1STEP(pdata))
-			tx_hwtstamp(pdata, &shhwtstamp);
 	}
 
 	return rec_id;
