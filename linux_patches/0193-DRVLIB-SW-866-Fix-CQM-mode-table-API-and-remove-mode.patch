From ac3a33f14ba51b7fb6b732c8fbd07c537a51d83e Mon Sep 17 00:00:00 2001
From: kavitha3 <k.subramanian@intel.com>
Date: Mon, 6 Aug 2018 17:15:33 +0800
Subject: [PATCH] DRVLIB_SW-866:Fix CQM mode table API and remove mode from
 cbm_queue_map_entry_t union

---
 drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c  | 4 ++--
 drivers/net/ethernet/lantiq/cqm/cqm_common.h   | 2 +-
 drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c | 5 ++---
 include/net/lantiq_cbm_api.h                   | 1 -
 4 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c b/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c
old mode 100644
new mode 100755
index 0573b364b9b2..99c67ea92021
--- a/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c
+++ b/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c
@@ -29,11 +29,11 @@ EXPORT_SYMBOL(cbm_queue_map_get);
 
 s32 cbm_queue_map_set(int cbm_inst, s32 queue_id,
 		      cbm_queue_map_entry_t *entry,
-		      u32 flags)
+		      u32 mode, u32 flags)
 {
 	if (g_cbm_ops->cbm_queue_map_set)
 		return g_cbm_ops->cbm_queue_map_set(
-		cbm_inst, queue_id, entry, flags);
+		cbm_inst, queue_id, entry, mode, flags);
 	else
 		return CBM_FAILURE;
 }
diff --git a/drivers/net/ethernet/lantiq/cqm/cqm_common.h b/drivers/net/ethernet/lantiq/cqm/cqm_common.h
old mode 100644
new mode 100755
index 6d59aa9c7f80..bfa52e8d74e3
--- a/drivers/net/ethernet/lantiq/cqm/cqm_common.h
+++ b/drivers/net/ethernet/lantiq/cqm/cqm_common.h
@@ -102,7 +102,7 @@ struct cbm_ops {
 				 cbm_queue_map_entry_t **entries,
 				 u32 flags);
 	s32 (*cbm_queue_map_set)(int cbm_inst, s32 queue_id,
-				 cbm_queue_map_entry_t *entry, u32 flags);
+				 cbm_queue_map_entry_t *entry, u32 mode, u32 flags);
 	s32 (*cqm_qid2ep_map_get)(int qid, int *port);
 	s32 (*cqm_qid2ep_map_set)(int qid, int port);
 	s32 (*cqm_mode_table_get)(int cbm_inst, int *mode,
diff --git a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
old mode 100644
new mode 100755
index 1dc37526dab0..831c101f6140
--- a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
+++ b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
@@ -616,9 +616,9 @@ static s32 mode_table_get(int cbm_inst, int *mode,
 }
 
 static s32 mode_table_set(int cbm_inst, cbm_queue_map_entry_t *entry,
-			  u32 flags)
+			  u32 mode, u32 flags)
 {
-	u32 mpe, ep, mode;
+	u32 mpe, ep;
 	struct cqm_qidt_elm qidt_idx = {0};
 	struct cqm_qidt_elm qidt_elm = {0};
 	int state;
@@ -627,7 +627,6 @@ static s32 mode_table_set(int cbm_inst, cbm_queue_map_entry_t *entry,
 
 	mpe = (entry->mpe1 & 0x1) | ((entry->mpe2 & 0x1) << 1);
 	ep = entry->ep;
-	mode = entry->mode;
 	state = STATE_EP;
 	while (state != STATE_NONE) {
 		switch (state) {
diff --git a/include/net/lantiq_cbm_api.h b/include/net/lantiq_cbm_api.h
old mode 100644
new mode 100755
index ca6a81bc3ddc..fca4a20ab432
--- a/include/net/lantiq_cbm_api.h
+++ b/include/net/lantiq_cbm_api.h
@@ -439,7 +439,6 @@ typedef union {
 		uint32_t	resv:6;/*resv*/
 	};
 	uint32_t	flags; /*!< Flags stored in DDR CBM Queue map table. Currently, only flag defined is CBM_F_QUEUE_DROP */
-	uint32_t	mode;
 } cbm_queue_map_entry_t;
 
 /*!
