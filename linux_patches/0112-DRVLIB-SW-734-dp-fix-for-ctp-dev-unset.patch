From 1a323de4bea4a6af1213ef541d08b3501b37a071 Mon Sep 17 00:00:00 2001
From: anishkhx <anishx.khurana@intel.com>
Date: Mon, 2 Jul 2018 22:57:30 +0800
Subject: [PATCH] DRVLIB_SW-734 dp fix for ctp_dev unset

---
 drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c
index ae6efc12bcab..ad9d3c9e9843 100644
--- a/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c
+++ b/drivers/net/ethernet/lantiq/datapath/gswip31/datapath_misc.c
@@ -1148,9 +1148,9 @@ static int subif_hw_reset(int inst, int portid, int subif_ix,
 	dp_q_tbl[inst][qid].ref_cnt--;
 	dp_deq_port_tbl[inst][cqm_deq_port].ref_cnt--;
 	if (port_info->subif_info[subif_ix].ctp_dev) { /* pmapper */
+		port_info->subif_info[subif_ix].ctp_dev = NULL;
 		dp_bp_dev_tbl[inst][bp].ref_cnt--;
 		if (!dp_bp_dev_tbl[inst][bp].ref_cnt) {
-			port_info->subif_info[subif_ix].ctp_dev = NULL;
 			dp_bp_dev_tbl[inst][bp].dev = NULL;
 			dp_bp_dev_tbl[inst][bp].flag = 0;
 			DP_DEBUG(DP_DBG_FLAG_REG,
