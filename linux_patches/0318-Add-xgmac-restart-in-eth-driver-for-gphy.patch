From 6959bd1d76cbf887a8c3c593ad572857fcbd9911 Mon Sep 17 00:00:00 2001
From: Peter Harliman Liem <peter.harliman.liem@intel.com>
Date: Tue, 9 Oct 2018 15:31:46 +0800
Subject: [PATCH] Add xgmac restart in eth driver for gphy

This is required per recommendation of xgmac
team.
---
 drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c b/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
index e86c6e503294..c03b179e8c51 100644
--- a/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
+++ b/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
@@ -1548,6 +1548,7 @@ static int prx300_phy_connect(struct net_device *dev, struct xrx500_port *port)
 {
 	struct phy_device *phydev = NULL;
 	struct ltq_eth_priv *priv = NULL;
+	struct mac_ops *ops;
 
 	priv = netdev_priv(dev);
 
@@ -1570,6 +1571,11 @@ static int prx300_phy_connect(struct net_device *dev, struct xrx500_port *port)
 	phydev->advertising = phydev->supported;
 	port->phydev = phydev;
 
+	/* restart xgmac */
+	ops = gsw_get_mac_ops(0, priv->xgmac_id);
+	if (ops && ops->soft_restart)
+		ops->soft_restart(ops);
+
 	pr_info("%s: attached PHY [%s] (phy_addr=%s, irq=%d)\n",
 		dev->name, phydev->drv->name,
 		phydev_name(phydev), phydev->irq);
