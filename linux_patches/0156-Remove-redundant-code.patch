From 3f037dfe3063ef7557c9000ef7b4028209affef2 Mon Sep 17 00:00:00 2001
From: kavitha3 <k.subramanian@intel.com>
Date: Mon, 16 Jul 2018 17:52:37 +0800
Subject: [PATCH] Remove redundant code

---
 drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c | 9 +--------
 1 file changed, 1 insertion(+), 8 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
index 61d199d3375f..1dc37526dab0 100644
--- a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
+++ b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
@@ -1672,8 +1672,6 @@ static s32 cqm_cpu_pkt_tx(struct sk_buff *skb, struct cbm_tx_data *data,
 	u32 new_buf = 0;
 	s32 clone_f, shared_f, no_hdr_room_f = 0;
 	int pool, policy, tot_len, buf_size, cpu_buf;
-	int copied_to_cbm = 0;
-	void *metadata;
 
 	dev_dbg(cqm_ctrl->dev, "%s\n", __func__);
 	tot_len = skb->len;
@@ -1705,10 +1703,7 @@ static s32 cqm_cpu_pkt_tx(struct sk_buff *skb, struct cbm_tx_data *data,
 				pr_err("linearize failed\n");
 				goto ERR_CASE_1;
 			}
-			copied_to_cbm = 1;
 			tmp_data_ptr = new_buf;
-			if (data && data->pmac)
-				skb->len += data->pmac_len;
 			dev_dbg(cqm_ctrl->dev, "tmp_data_ptr 0x%x\n",
 				tmp_data_ptr);
 		}
@@ -1730,7 +1725,7 @@ static s32 cqm_cpu_pkt_tx(struct sk_buff *skb, struct cbm_tx_data *data,
 		skb->head = NULL;
 	}
 	if (setup_desc((struct cbm_desc *)&desc, tmp_data_ptr,
-		       (skb->len < (ETH_ZLEN + 8)) ? (ETH_ZLEN + 8) : skb->len,
+		       tot_len,
 		       skb->DW1, skb->DW0, skb->DW3, pool, policy)) {
 		dev_err(cqm_ctrl->dev, "cbm setup desc failed..\n");
 		cqm_buffer_free(smp_processor_id(), (void *)tmp_data_ptr, 1);
@@ -1740,8 +1735,6 @@ static s32 cqm_cpu_pkt_tx(struct sk_buff *skb, struct cbm_tx_data *data,
 
 	if (cqm_cpu_enqueue(smp_processor_id(), &desc)) {
 		dev_err(cqm_ctrl->dev, "cpu enqueue failed..\n");
-		if (pool == CQM_CPU_POOL && policy == CQM_CPU_POLICY)
-			goto ERR_CASE_2;
 		cqm_buffer_free(smp_processor_id(), (void *)tmp_data_ptr, 1);
 		return CBM_FAILURE;
 	}
