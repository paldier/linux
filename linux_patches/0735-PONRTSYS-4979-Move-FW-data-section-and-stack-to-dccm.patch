From a789318b3a1735a095ec864f50626131f9a9ab4f Mon Sep 17 00:00:00 2001
From: Oren Bakshe <oren.bakshe@intel.com>
Date: Mon, 12 Aug 2019 14:16:10 +0300
Subject: [PATCH] PONRTSYS-4979: Move FW data section and stack to dccm

---
 drivers/net/ethernet/lantiq/ppv4/qos/pp_qos_linux.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/net/ethernet/lantiq/ppv4/qos/pp_qos_linux.c b/drivers/net/ethernet/lantiq/ppv4/qos/pp_qos_linux.c
index c0f469827402..df554e4197aa 100644
--- a/drivers/net/ethernet/lantiq/ppv4/qos/pp_qos_linux.c
+++ b/drivers/net/ethernet/lantiq/ppv4/qos/pp_qos_linux.c
@@ -40,6 +40,7 @@
 #include "pp_qos_common.h"
 #include "pp_qos_utils.h"
 #include "pp_qos_fw.h"
+#include "lantiq.h"
 
 /*
  * TODO - this obstruct multi instances but helps debug
@@ -363,6 +364,10 @@ static int pp_qos_config_from_of_node(
 	p = of_prop_next_u32(prop, p, &pdrvdata->fw_sec_data_stack.dccm_offset);
 	p = of_prop_next_u32(prop, p, &pdrvdata->fw_sec_data_stack.max_size);
 
+	/* dccm is not available for A Step */
+	if (ltq_get_soc_rev() == 0)
+		pdrvdata->fw_sec_data_stack.is_in_dccm = 0;
+
 	addr = dmam_alloc_coherent(
 			dev,
 			PPV4_QOS_LOGGER_BUF_SIZE + PPV4_QOS_STAT_SIZE,
