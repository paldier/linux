From 38d6da2b4b901ea1567eacf9727bf199970570d6 Mon Sep 17 00:00:00 2001
From: Li Yin <yin1.li@intel.com>
Date: Tue, 2 Jul 2019 13:32:58 +0800
Subject: [PATCH] datapath: ctp_assign is fixed

---
 drivers/net/datapath/dpm/gswip32/datapath_gswip.c        | 15 ++++++++-------
 drivers/net/datapath/dpm/gswip32/datapath_misc.c         |  2 +-
 drivers/net/datapath/dpm/gswip32/datapath_misc.h         |  2 +-
 drivers/net/datapath/dpm/gswip32/datapath_ppv4_session.c |  2 +-
 4 files changed, 11 insertions(+), 10 deletions(-)

diff --git a/drivers/net/datapath/dpm/gswip32/datapath_gswip.c b/drivers/net/datapath/dpm/gswip32/datapath_gswip.c
index d4f3dd87b539..f90bf08e2b0c 100644
--- a/drivers/net/datapath/dpm/gswip32/datapath_gswip.c
+++ b/drivers/net/datapath/dpm/gswip32/datapath_gswip.c
@@ -34,7 +34,7 @@
 #define METER_CIR(cir)  ((cir) / 1000)
 #define METER_PIR(pir)  ((pir) / 1000)
 
-static struct ctp_assign ctp_assign_info[] = {
+static const struct ctp_assign ctp_assign_info[] = {
 	/*note: multiple flags must put first */
 	{DP_F_CPU, GSW_LOGICAL_PORT_8BIT_WLAN, 16, 8, 0xF, CQE_LU_MODE2, 8, 0},
 	{DP_F_GPON, GSW_LOGICAL_PORT_GPON, 256, 0, 0xFF, CQE_LU_MODE1, 128, 1},
@@ -60,12 +60,13 @@ static struct ctp_assign ctp_assign_info[] = {
 		CQE_LU_MODE2, 16, 0}
 };
 
-static struct ctp_assign ctp_assign_def = {0, GSW_LOGICAL_PORT_8BIT_WLAN, 8, 8,
-					   0xF, CQE_LU_MODE2, 8, 1};
+static const struct ctp_assign ctp_assign_def = {
+	0, GSW_LOGICAL_PORT_8BIT_WLAN, 8, 8, 0xF, CQE_LU_MODE2, 8, 1
+};
 
 static struct gsw_itf itf_assign[PMAC_MAX_NUM] = {0};
 
-struct ctp_assign *get_ctp_assign(int flags)
+const struct ctp_assign *get_ctp_assign(int flags)
 {
 	int i;
 
@@ -583,7 +584,7 @@ struct gsw_itf *ctp_port_assign_32(int inst, u8 ep, int bp_default,
 				u32 flags, struct dp_dev_data *data)
 {
 	GSW_CTP_portAssignment_t ctp_assign;
-	struct ctp_assign *assign = &ctp_assign_def;
+	const struct ctp_assign *assign = &ctp_assign_def;
 	int i, alloc_flag;
 	u16 num;
 	struct core_ops *gsw_handle;
@@ -655,7 +656,7 @@ struct gsw_itf *ctp_port_assign_32(int inst, u8 ep, int bp_default,
 int set_port_lookup_mode_32(int inst, u8 ep, u32 flags)
 {
 	int i, alloc_flag;
-	struct ctp_assign *assign = &ctp_assign_def;
+	const struct ctp_assign *assign = &ctp_assign_def;
 	struct pmac_port_info *port_info = get_dp_port_info(inst, ep);
 
 	alloc_flag = port_info->alloc_flags;
@@ -1586,7 +1587,7 @@ int gpid_port_assign(int inst, u8 ep, u32 flags)
 	GSW_GPID_to_LPID_Assignment_t gp_lp_assign;
 	int gpid_base, gpid_num, i, gpid_spl = -1;
 	struct core_ops *gsw_handle = dp_port_prop[inst].ops[GSWIP_L];
-	struct ctp_assign *assign;
+	const struct ctp_assign *assign;
 	struct cbm_gpid_lpid cbm_gpid = {0};
 	struct hal_priv *priv;
 
diff --git a/drivers/net/datapath/dpm/gswip32/datapath_misc.c b/drivers/net/datapath/dpm/gswip32/datapath_misc.c
index bf48610dd2b1..25dd3d7f99ef 100644
--- a/drivers/net/datapath/dpm/gswip32/datapath_misc.c
+++ b/drivers/net/datapath/dpm/gswip32/datapath_misc.c
@@ -1044,7 +1044,7 @@ int dp_platform_queue_set_32(int inst, u32 flag)
 	struct dp_subif_info *subif_info;
 	struct dp_dflt_hostif hostif = {0};
 	int vap_num = 0;
-	struct ctp_assign *cpu_assign = get_ctp_assign(DP_F_CPU);
+	const struct ctp_assign *cpu_assign = get_ctp_assign(DP_F_CPU);
 
 	if (!cpu_assign) {
 		DP_ERR("cpu_assign NULL\n");
diff --git a/drivers/net/datapath/dpm/gswip32/datapath_misc.h b/drivers/net/datapath/dpm/gswip32/datapath_misc.h
index 1d38fc1efcaf..fbe045272329 100644
--- a/drivers/net/datapath/dpm/gswip32/datapath_misc.h
+++ b/drivers/net/datapath/dpm/gswip32/datapath_misc.h
@@ -263,7 +263,7 @@ int set_port_lookup_mode_32(int inst, u8 ep, u32 flags);
 int tc_vlan_set_32(struct core_ops *ops, struct dp_tc_vlan *vlan,
 		   struct dp_tc_vlan_info *info,
 		   int flag);
-struct ctp_assign *get_ctp_assign(int flags);
+const struct ctp_assign *get_ctp_assign(int flags);
 int dp_get_lookup_qid_via_index(struct cbm_lookup *info);
 void dp_set_lookup_qid_via_index(struct cbm_lookup *info);
 
diff --git a/drivers/net/datapath/dpm/gswip32/datapath_ppv4_session.c b/drivers/net/datapath/dpm/gswip32/datapath_ppv4_session.c
index 0d3ba5dd3f72..80d73db66358 100644
--- a/drivers/net/datapath/dpm/gswip32/datapath_ppv4_session.c
+++ b/drivers/net/datapath/dpm/gswip32/datapath_ppv4_session.c
@@ -188,7 +188,7 @@ int get_subif_size(u32 vap_mask)
 int dp_add_pp_gpid(int inst, int dpid, int vap, int gpid, int spl_gpid)
 {
 	struct pp_port_cfg cfg = {0};
-	struct ctp_assign *ctp_info;
+	const struct ctp_assign *ctp_info;
 	struct pmac_port_info *port_info;
 	int i;
 	struct hal_priv *priv;
