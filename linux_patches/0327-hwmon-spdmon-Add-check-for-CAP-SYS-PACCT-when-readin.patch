From ac14d414a05bdea0022982bf0e011a853f8c4443 Mon Sep 17 00:00:00 2001
From: Waldemar Rymarkiewicz <waldemarx.rymarkiewicz@intel.com>
Date: Mon, 29 Oct 2018 11:31:57 +0100
Subject: [PATCH] hwmon: spdmon: Add check for CAP_SYS_PACCT when reading sysfs

 To fulfill SDL requirements.

Signed-off-by: Waldemar Rymarkiewicz <waldemarx.rymarkiewicz@intel.com>
---
 drivers/hwmon/spdmon.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/hwmon/spdmon.c b/drivers/hwmon/spdmon.c
index 119a931068ea..01134c05a899 100644
--- a/drivers/hwmon/spdmon.c
+++ b/drivers/hwmon/spdmon.c
@@ -240,6 +240,9 @@ static int show_value(struct device *dev,
 	struct spd_cnt smcl;
 	struct sensor_device_attribute *attr = to_sensor_dev_attr(devattr);
 
+	if (!capable(CAP_SYS_PACCT))
+		return -EPERM;
+
 	if (attr->index == SHOW_NAME)
 		return sprintf(buf, "%s\n", SPD_MON_NAME);
 	else if (attr->index == SHOW_CLASS_B) {
