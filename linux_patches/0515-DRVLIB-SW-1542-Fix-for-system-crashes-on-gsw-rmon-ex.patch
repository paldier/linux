From 35280035cfe63fbb29acfae4b0c749754e4ed948 Mon Sep 17 00:00:00 2001
From: Dinesh Sudham <dineshx.sudham@intel.com>
Date: Wed, 6 Mar 2019 00:13:38 +0800
Subject: [PATCH] DRVLIB_SW-1542:Fix for system crashes on gsw_rmon_extend

---
 drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.c | 6 ++++++
 drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.h | 4 ++++
 2 files changed, 10 insertions(+)

diff --git a/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.c b/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.c
index 842da3fdc3c2..818f6ea14904 100644
--- a/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.c
+++ b/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.c
@@ -25692,6 +25692,12 @@ GSW_return_t GSW_RMON_ExtendGet(void *cdev, GSW_RMON_extendGet_t *parm)
 	spin_lock_bh(&gswdev->lock_bm);
 #endif
 
+	if (IS_VRSN_31_OR_32(gswdev->gipver)) {
+		/* GSW_RMON_ExtendGet will not support above 3.0 */
+		ret = GSW_statusNoSupport;
+		goto UNLOCK_AND_RETURN;
+	}
+
 	if (parm->nPortId >= gswdev->tpnum) {
 		ret = GSW_statusErr;
 		goto UNLOCK_AND_RETURN;
diff --git a/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.h b/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.h
index 087c36e55f66..8770068dc16a 100644
--- a/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.h
+++ b/drivers/net/ethernet/lantiq/switch-api/gsw_flow_core.h
@@ -171,10 +171,14 @@ Where as CLEAR_FILL_CTRL_REG takes care of clear then fill.
 #define LTQ_GSWIP_2_2_ETC 0x023
 #define LTQ_GSWIP_3_0 0x030
 #define LTQ_GSWIP_3_1 0x031
+#define LTQ_GSWIP_3_2 0x032
 
 #define IS_VRSN_30_31(ver) \
 	((ver == LTQ_GSWIP_3_0) || (ver == LTQ_GSWIP_3_1))
 
+#define IS_VRSN_31_OR_32(ver) \
+	((ver == LTQ_GSWIP_3_1) || (ver == LTQ_GSWIP_3_2))
+
 #define IS_VRSN_31(ver) \
 	((ver == LTQ_GSWIP_3_1))
 
