From d45d581bd5db65f0b045281095f88509a45dae5f Mon Sep 17 00:00:00 2001
From: kavitha3 <k.subramanian@intel.com>
Date: Tue, 7 Aug 2018 12:17:19 +0800
Subject: [PATCH] DRVLIB_SW-866:Fix API prototype bug

---
 drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c  | 10 ++++++----
 drivers/net/ethernet/lantiq/cqm/cqm_common.h   |  4 ++--
 drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c |  1 -
 include/net/lantiq_cbm_api.h                   |  1 +
 4 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c b/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c
index 99c67ea92021..e5d750987eb5 100644
--- a/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c
+++ b/drivers/net/ethernet/lantiq/cqm/cbm_wrapper.c
@@ -29,11 +29,11 @@ EXPORT_SYMBOL(cbm_queue_map_get);
 
 s32 cbm_queue_map_set(int cbm_inst, s32 queue_id,
 		      cbm_queue_map_entry_t *entry,
-		      u32 mode, u32 flags)
+		      u32 flags)
 {
 	if (g_cbm_ops->cbm_queue_map_set)
 		return g_cbm_ops->cbm_queue_map_set(
-		cbm_inst, queue_id, entry, mode, flags);
+		cbm_inst, queue_id, entry, flags);
 	else
 		return CBM_FAILURE;
 }
@@ -58,10 +58,12 @@ s32 cqm_qid2ep_map_get(int qid, int *port)
 EXPORT_SYMBOL(cqm_qid2ep_map_get);
 
 s32
-cqm_mode_table_set(int cbm_inst, cbm_queue_map_entry_t *entry, u32 flags)
+cqm_mode_table_set(int cbm_inst, cbm_queue_map_entry_t *entry, u32 mode,
+		   u32 flags)
 {
 	if (g_cbm_ops->cqm_mode_table_set)
-		return g_cbm_ops->cqm_mode_table_set(cbm_inst, entry, flags);
+		return g_cbm_ops->cqm_mode_table_set(cbm_inst, entry, mode,
+						     flags);
 	else
 		return CBM_FAILURE;
 }
diff --git a/drivers/net/ethernet/lantiq/cqm/cqm_common.h b/drivers/net/ethernet/lantiq/cqm/cqm_common.h
index bfa52e8d74e3..51435a12b203 100644
--- a/drivers/net/ethernet/lantiq/cqm/cqm_common.h
+++ b/drivers/net/ethernet/lantiq/cqm/cqm_common.h
@@ -102,13 +102,13 @@ struct cbm_ops {
 				 cbm_queue_map_entry_t **entries,
 				 u32 flags);
 	s32 (*cbm_queue_map_set)(int cbm_inst, s32 queue_id,
-				 cbm_queue_map_entry_t *entry, u32 mode, u32 flags);
+				 cbm_queue_map_entry_t *entry, u32 flags);
 	s32 (*cqm_qid2ep_map_get)(int qid, int *port);
 	s32 (*cqm_qid2ep_map_set)(int qid, int port);
 	s32 (*cqm_mode_table_get)(int cbm_inst, int *mode,
 				  cbm_queue_map_entry_t *entry, u32 flags);
 	s32 (*cqm_mode_table_set)(int cbm_inst,
-				  cbm_queue_map_entry_t *entry,
+				  cbm_queue_map_entry_t *entry, u32 mode,
 				  u32 flags);
 	int (*cbm_setup_desc)(struct cbm_desc *desc, u32 data_ptr, u32 data_len,
 			      u32 DW0, u32 DW1);
diff --git a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
index 831c101f6140..26201f354abd 100644
--- a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
+++ b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
@@ -1081,7 +1081,6 @@ static s32 queue_map_get(int cbm_inst, s32 queue_id, s32 *num_entries,
 			       (offset_1 << 2));
 		mode >>= (temp_entry[i].ep << 1);
 		mode = mode & 0x3;
-		temp_entry[i].mode = mode;
 		sel_field = (index & 0xf) |
 			     (((index & 0x3c00) >> 6) & 0xf0);
 		switch (mode) {
diff --git a/include/net/lantiq_cbm_api.h b/include/net/lantiq_cbm_api.h
index fca4a20ab432..204c52256843 100644
--- a/include/net/lantiq_cbm_api.h
+++ b/include/net/lantiq_cbm_api.h
@@ -1231,6 +1231,7 @@ s32
 cqm_mode_table_set(
 	int cbm_inst,
 	cbm_queue_map_entry_t *entry,
+	u32 mode,
 	u32 flags
 	);
 
