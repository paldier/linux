From 3229a509dbbfa48dcb845170977c33c8ab75ec92 Mon Sep 17 00:00:00 2001
From: thampan <joby.thampan@intel.com>
Date: Fri, 28 Sep 2018 09:51:41 +0800
Subject: [PATCH] Mac Api's to do a soft restart

---
 drivers/net/ethernet/lantiq/switch-api/mac/mac_cfg.c | 8 ++++++++
 include/net/switch_api/mac_ops.h                     | 5 +++++
 2 files changed, 13 insertions(+)

diff --git a/drivers/net/ethernet/lantiq/switch-api/mac/mac_cfg.c b/drivers/net/ethernet/lantiq/switch-api/mac/mac_cfg.c
index 4caba3325e53..4e1ee6ad5d78 100644
--- a/drivers/net/ethernet/lantiq/switch-api/mac/mac_cfg.c
+++ b/drivers/net/ethernet/lantiq/switch-api/mac/mac_cfg.c
@@ -1325,6 +1325,13 @@ int mac_irq_clr(void *pdev, u32 event)
 	return 0;
 }
 
+static void mac_soft_restart(void *pdev)
+{
+	/* Bring Down and up Xgmac Tx and Rx, Not all register reset */
+	xgmac_powerdown(pdev);
+	xgmac_powerup(pdev);
+}
+
 void mac_init_fn_ptrs(struct mac_ops *mac_op)
 {
 	mac_op->set_flow_ctl = mac_set_flowctrl;
@@ -1387,6 +1394,7 @@ void mac_init_fn_ptrs(struct mac_ops *mac_op)
 	mac_op->do_tx_hwts = xgmac_tx_hwts;
 	mac_op->mac_get_ts_info = xgmac_get_ts_info;
 #endif
+	mac_op->soft_restart = mac_soft_restart;
 
 	mac_op->set_macaddr = mac_set_macaddr;
 	mac_op->set_rx_crccheck = mac_set_rxcrccheck;
diff --git a/include/net/switch_api/mac_ops.h b/include/net/switch_api/mac_ops.h
index cb8bdec65092..30450a35b658 100644
--- a/include/net/switch_api/mac_ops.h
+++ b/include/net/switch_api/mac_ops.h
@@ -402,6 +402,11 @@ struct mac_ops {
 	 * return	OUT	-1: 	Initialize MAC Error
 	 */
 	int(*mac_get_ts_info)(void *, struct ethtool_ts_info *);
+	/* This sequence is to do soft restart of Xgmac
+	 * param[in/out]IN:	ops	MAC ops Struct registered for MAC 0/1/2.
+	 * return	OUT	-1:	Initialize MAC Error
+	 */
+	void(*soft_restart)(void *);
 #endif
 	/* This sequence is used Initialize MAC
 	 * param[in/out]IN:	ops	MAC ops Struct registered for MAC 0/1/2.
