From fbe43e109974aa31b50c8ab083c4ad91f74f5837 Mon Sep 17 00:00:00 2001
From: thampan <joby.thampan@intel.com>
Date: Fri, 11 Jan 2019 10:20:53 +0800
Subject: [PATCH] Check to make compilation pass for GRX500

---
 drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c | 41 +++++++++++++-----------
 1 file changed, 23 insertions(+), 18 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c b/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
index 04e2694b98a0..6485f991eb0a 100644
--- a/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
+++ b/drivers/net/ethernet/lantiq/ltq_eth_drv_xrx500.c
@@ -266,14 +266,17 @@ int serdes_ethtool_get_link_ksettings(struct net_device *dev,
 	if (!priv->xpcs_node)
 		return -1;
 
-	pdev = of_find_device_by_node(priv->xpcs_node);
-	if (pdev) {
-		/* Speed Get in Ethtool */
-		xpcs_ethtool_ksettings_get(&pdev->dev, cmd);
-	} else {
-		pr_err("Cannot get Xpcs pdev for %s\n",dev->name);
-		ret = -1;
-	}
+        /* g_eth_switch_mode will be 0 for Fmx and Lgm */
+        if (g_eth_switch_mode == 0) {
+            pdev = of_find_device_by_node(priv->xpcs_node);
+            if (pdev) {
+                /* Speed Get in Ethtool */
+                xpcs_ethtool_ksettings_get(&pdev->dev, cmd);
+            } else {
+                pr_err("Cannot get Xpcs pdev for %s\n",dev->name);
+                ret = -1;
+            }
+        }
 
 	return ret;
 }
@@ -288,16 +291,18 @@ int serdes_ethtool_set_link_ksettings(struct net_device *dev,
 	if (!priv->xpcs_node)
 		return -1;
 
-	/* Speed Set in Ethtool */
-	pdev = of_find_device_by_node(priv->xpcs_node);
-	if (pdev) {
-		/* Speed Get in Ethtool */
-		ret = xpcs_ethtool_ksettings_set(&pdev->dev, cmd);
-	} else {
-		pr_err("Cannot get Xpcs pdev for %s\n",dev->name);
-		ret = -1;
-	}
-
+        /* g_eth_switch_mode will be 0 for Fmx and Lgm */
+        if (g_eth_switch_mode == 0) {
+            /* Speed Set in Ethtool */
+            pdev = of_find_device_by_node(priv->xpcs_node);
+            if (pdev) {
+                /* Speed Get in Ethtool */
+                ret = xpcs_ethtool_ksettings_set(&pdev->dev, cmd);
+            } else {
+                pr_err("Cannot get Xpcs pdev for %s\n",dev->name);
+                ret = -1;
+            }
+        }
 	return ret;
 }
 
