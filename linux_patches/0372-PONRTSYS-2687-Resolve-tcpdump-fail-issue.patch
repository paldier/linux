From 4524a6d03416666abc0dc3292cbf237498b2cf5a Mon Sep 17 00:00:00 2001
From: Rekha Eswaran <rekha.eswaran@intel.com>
Date: Wed, 28 Nov 2018 14:30:07 +0800
Subject: [PATCH] PONRTSYS-2687 : Resolve tcpdump fail issue

---
 drivers/net/ethernet/lantiq/datapath/datapath_ioctl.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/datapath/datapath_ioctl.c b/drivers/net/ethernet/lantiq/datapath/datapath_ioctl.c
index 7e75fe128898..52d64c277d34 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath_ioctl.c
+++ b/drivers/net/ethernet/lantiq/datapath/datapath_ioctl.c
@@ -10,13 +10,16 @@ static int get_tsinfo(struct net_device *dev,
 		      struct ethtool_ts_info *ts_info)
 {
 	struct mac_ops *ops;
-	struct pmac_port_info *port = get_port_info_via_dp_name(dev);
+	dp_subif_t subif = {0};
 	int inst = 0;
 	int err = 0;
 
-	if (!port)
+	if (dp_get_netif_subifid(dev, NULL, NULL, NULL, &subif, 0)) {
+		PR_ERR("%s dp_get_netif_subifid failed for %s\n",
+				__func__, dev->name);
 		return -EFAULT;
-	ops = dp_port_prop[inst].mac_ops[port->port_id];
+	}
+	ops = dp_port_prop[inst].mac_ops[subif.port_id];
 	if (!ops)
 		return -EFAULT;
 	err = ops->mac_get_ts_info(ops, ts_info);
