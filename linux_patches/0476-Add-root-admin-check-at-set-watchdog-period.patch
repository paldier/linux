From 6807cb6098856c8995d7f909339bb7f5d2e05975 Mon Sep 17 00:00:00 2001
From: Wu Zhixian <zhixianx.wu@intel.com>
Date: Mon, 31 Dec 2018 11:01:56 +0800
Subject: [PATCH] Add root admin check at set watchdog period

fix comments

https://jira-chd.intel.com/browse/DRVLIB_SW-1044
---
 drivers/watchdog/bootcore_wdt.c | 3 +++
 drivers/watchdog/grx500_wdt.c   | 3 +++
 2 files changed, 6 insertions(+)

diff --git a/drivers/watchdog/bootcore_wdt.c b/drivers/watchdog/bootcore_wdt.c
index 4ffbd3afe343..b1137e1fb1bf 100644
--- a/drivers/watchdog/bootcore_wdt.c
+++ b/drivers/watchdog/bootcore_wdt.c
@@ -163,6 +163,9 @@ static long bootcorewdt_ioctl (struct watchdog_device *wdd , unsigned int cmd, u
 
 	switch (cmd) {
 	case WDIOC_SETPRETIMEOUT:
+
+		if (!capable(CAP_SYS_ADMIN))
+			return -EPERM;
 		if (get_user(pval, p))
 			return -EFAULT;
 
diff --git a/drivers/watchdog/grx500_wdt.c b/drivers/watchdog/grx500_wdt.c
index ab1a283e31df..a90322fef78a 100644
--- a/drivers/watchdog/grx500_wdt.c
+++ b/drivers/watchdog/grx500_wdt.c
@@ -179,6 +179,9 @@ static int grx500wdt_set_timeout(struct watchdog_device *wdt_dev,
 {
 	struct watchdog_device *grx500_wdt;
 
+	if (!capable(CAP_SYS_ADMIN))
+		return -EPERM;
+
 	/* grx500_wdt = &per_cpu(grx500wdt, smp_processor_id()); */
 	grx500_wdt = wdt_dev;
 
