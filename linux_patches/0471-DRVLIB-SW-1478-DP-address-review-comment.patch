From 8b92d1e34e45c83d3f1ad25f834cc68d261d7379 Mon Sep 17 00:00:00 2001
From: Rekha Eswaran <rekha.eswaran@intel.com>
Date: Fri, 15 Feb 2019 11:05:10 +0800
Subject: [PATCH] DRVLIB_SW-1478: DP address review comment

---
 drivers/net/ethernet/lantiq/cqm/grx500/cbm.c         |  1 +
 drivers/net/ethernet/lantiq/datapath/datapath_api.c  |  2 +-
 drivers/net/ethernet/lantiq/datapath/datapath_proc.c | 10 +++++-----
 3 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/cqm/grx500/cbm.c b/drivers/net/ethernet/lantiq/cqm/grx500/cbm.c
index c10c1fe63972..09fa05a19733 100644
--- a/drivers/net/ethernet/lantiq/cqm/grx500/cbm.c
+++ b/drivers/net/ethernet/lantiq/cqm/grx500/cbm.c
@@ -3019,6 +3019,7 @@ dp_port_alloc(
 	data->dp_port = port_id;
 	data->deq_port = (flags & DP_F_FAST_WLAN) ? cbm_port[i] : cbm_port[0];
 	data->deq_port_num = 1;
+	data->num_dma_chan = 1;
 	return CBM_SUCCESS;
 }
 
diff --git a/drivers/net/ethernet/lantiq/datapath/datapath_api.c b/drivers/net/ethernet/lantiq/datapath/datapath_api.c
index 90b4a6c26d9a..78af8000346f 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath_api.c
+++ b/drivers/net/ethernet/lantiq/datapath/datapath_api.c
@@ -47,7 +47,7 @@ struct dma_rx_desc_1 dma_tx_desc_mask1;
 u32 dp_drop_all_tcp_err;
 u32 dp_pkt_size_check;
 
-u32 dp_dbg_flag;
+u32 dp_dbg_flag=DP_DBG_FLAG_DBG|DP_DBG_FLAG_REG;
 EXPORT_SYMBOL(dp_dbg_flag);
 
 #ifdef CONFIG_LTQ_DATAPATH_MPE_FASTHOOK_TEST
diff --git a/drivers/net/ethernet/lantiq/datapath/datapath_proc.c b/drivers/net/ethernet/lantiq/datapath/datapath_proc.c
index 44a30f7e4273..7f536a45b663 100644
--- a/drivers/net/ethernet/lantiq/datapath/datapath_proc.c
+++ b/drivers/net/ethernet/lantiq/datapath/datapath_proc.c
@@ -206,11 +206,11 @@ int proc_port_dump(struct seq_file *s, int pos)
 		cid = _DMA_CONTROLLER(dp_deq_port_tbl[tmp_inst][cqm_p].dma_chan);
 		pid = _DMA_PORT(dp_deq_port_tbl[tmp_inst][cqm_p].dma_chan);
 		nid = _DMA_CHANNEL(dp_deq_port_tbl[tmp_inst][cqm_p].dma_chan);
-		seq_printf(s, "          : dma_ch/node:    0x%x/%d(ref=%d)\n",
-			   nid,
-			   port->subif_info[i].qos_deq_port,
-			   atomic_read(&dp_dma_chan_tbl[tmp_inst][cid][pid]
-					[nid].ref_cnt));
+		if (port->num_dma_chan)
+			seq_printf(s, "          : dma_ch/port:    %d/%d(ref=%d)\n",
+				   nid, cqm_p,
+				   atomic_read(&dp_dma_chan_tbl[tmp_inst][cid]
+						[pid][nid].ref_cnt));
 
 		if (port->subif_info[i].ctp_dev &&
 		    port->subif_info[i].ctp_dev->name)
