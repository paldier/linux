From aeac23611eb62eaee0d26c0492c0b0e31fc3c9e8 Mon Sep 17 00:00:00 2001
From: kavitha3 <k.subramanian@intel.com>
Date: Tue, 26 Jun 2018 15:55:38 +0800
Subject: [PATCH] Enable PON wakeup intr, reset PON DQCNTR during init

---
 drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
index 1a24675614d1..8aa8683e4c07 100644
--- a/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
+++ b/drivers/net/ethernet/lantiq/cqm/falconmx/cqm.c
@@ -1928,7 +1928,11 @@ static s32 do_port_setting(u32 *pmac, u32 flags, u32 *cbm_port,
 		/*clear PIB bypass*/
 		ctrl.pib_bypass = 0;
 		ctrl.pib_en = 1;
-		config_pib_ctrl(&ctrl, FLAG_PIB_BYPASS | FLAG_PIB_ENABLE);
+		ctrl.wakeup_intr_en = 1;
+		config_pib_ctrl(&ctrl,
+				FLAG_PIB_BYPASS |
+				FLAG_PIB_ENABLE |
+				FLAG_PIB_WAKEUP_INTR);
 		if (cqm_ctrl->force_xpcs)
 			set_ifmux(FMX_WAN_AON_MODE);
 		else
@@ -3684,6 +3688,8 @@ static int cqm_falconmx_probe(struct platform_device *pdev)
 	}
 	for (i = 0; i < CQM_QID2EP_DW_NUM; i++)
 		cbm_w32((cqm_ctrl->qid2ep + i * 4), 0x0);
+	for (i = 0; i < FMX_MAX_PON_PORTS; i++)
+		cbm_w32((cqm_ctrl->pon_dqm_cntr + i * 4), 0x0);
 	spin_unlock_irqrestore(&cqm_qidt_lock, sys_flag);
 	bm_init(pdev);
 	qos_init(pdev);
