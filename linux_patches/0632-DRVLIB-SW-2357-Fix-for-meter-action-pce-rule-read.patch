From d469ce70d0e3f6c0eec1262038096d9fc87167e5 Mon Sep 17 00:00:00 2001
From: Dinesh Sudham <dineshx.sudham@intel.com>
Date: Tue, 4 Jun 2019 10:27:20 +0800
Subject: [PATCH] DRVLIB_SW-2357: Fix for meter action pce_rule_read

---
 .../net/ethernet/lantiq/switch-api/gsw_flow_pce.c   | 21 +++++++++++++++++++--
 1 file changed, 19 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/lantiq/switch-api/gsw_flow_pce.c b/drivers/net/ethernet/lantiq/switch-api/gsw_flow_pce.c
index f8dea12f4c68..ddd7dad6c9ea 100644
--- a/drivers/net/ethernet/lantiq/switch-api/gsw_flow_pce.c
+++ b/drivers/net/ethernet/lantiq/switch-api/gsw_flow_pce.c
@@ -2163,7 +2163,24 @@ int pce_rule_read(void *cdev, ltq_pce_table_t *pthandle, GSW_PCE_rule_t *parm)
 		}
 
 		if ((ptbl.val[0] >> 11) & 0x1) {
-			parm->action.eMeterAction = (ptbl.val[3] >> 6) & 0x3;
+			switch ((ptbl.val[3] >> 6) & 0x3) {
+			case 0:
+				parm->action.eMeterAction = GSW_PCE_ACTION_METER_REGULAR;
+				break;
+
+			case 1:
+				parm->action.eMeterAction = GSW_PCE_ACTION_METER_1;
+				break;
+
+			case 3:
+				parm->action.eMeterAction = GSW_PCE_ACTION_METER_1_2;
+				break;
+
+			default:
+				/* Action Disable, default it was set */
+				break;
+			}
+
 			parm->action.nMeterId = ptbl.val[3] & 0x1F;
 		}
 
@@ -2209,7 +2226,7 @@ int pce_rule_read(void *cdev, ltq_pce_table_t *pthandle, GSW_PCE_rule_t *parm)
 				parm->action.eMeterAction = GSW_PCE_ACTION_METER_1;
 				parm->action.nMeterId = ptbl.val[3] & 0x7F;
 			} else {
-				parm->action.eMeterAction = GSW_PCE_ACTION_METER_REGULAR;
+				parm->action.eMeterAction = GSW_PCE_ACTION_METER_DISABLE;
 			}
 		}
 
